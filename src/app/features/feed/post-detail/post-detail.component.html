<div class="post-detail-container">
  <div class="post-detail-header">
    <button class="back-button" (click)="goBack()">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M19 12H5M12 19l-7-7 7-7"/>
      </svg>
      Voltar
    </button>
  </div>

  @if (loading()) {
    <div class="loading-container">
      <div class="spinner"></div>
      <p>Carregando post...</p>
    </div>
  } @else if (post()) {
    <div class="post-detail-content">
      <div class="post-card">
        <div class="post-header">
          <div class="author-info">
            @if (post()!.authorPhotoUrl) {
              <img [src]="post()!.authorPhotoUrl" [alt]="post()!.authorName" class="author-avatar">
            } @else {
              <div class="author-avatar-placeholder">
                {{ post()!.authorName.charAt(0).toUpperCase() }}
              </div>
            }
            <div class="author-details">
              <h3 class="author-name">{{ post()!.authorName }}</h3>
              <span class="post-time">{{ getTimeDiff(post()!.createdAt) }}</span>
            </div>
          </div>

          @if (post()!.isPinned) {
            <span class="pinned-badge">游늷 Fixado</span>
          }
        </div>

        <div class="post-body">
          <p class="post-content">{{ post()!.content }}</p>
          
          @if (post()!.imageUrl) {
            <div class="post-image-container">
              <img [src]="post()!.imageUrl" [alt]="post()!.content" class="post-image">
            </div>
          }
        </div>

        <div class="post-stats">
          <span>{{ post()!.likesCount }} curtida{{ post()!.likesCount !== 1 ? 's' : '' }}</span>
          <span>{{ post()!.commentsCount }} coment치rio{{ post()!.commentsCount !== 1 ? 's' : '' }}</span>
          <span>{{ post()!.sharesCount }} compartilhamento{{ post()!.sharesCount !== 1 ? 's' : '' }}</span>
        </div>

        <div class="post-actions">
          <button 
            class="action-button" 
            [class.liked]="post()!.isLiked"
            (click)="onLike()">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
            </svg>
            Curtir
          </button>
          
          <button class="action-button" (click)="onShare()">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="18" cy="5" r="3"></circle>
              <circle cx="6" cy="12" r="3"></circle>
              <circle cx="18" cy="19" r="3"></circle>
              <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
              <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
            </svg>
            Compartilhar
          </button>
          
          <button 
            class="action-button" 
            [class.saved]="post()!.isSaved"
            (click)="onSave()">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="m19 21-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z"></path>
            </svg>
            {{ post()!.isSaved ? 'Salvo' : 'Salvar' }}
          </button>
        </div>
      </div>

      <div class="comments-section">
        <h2 class="comments-title">Coment치rios ({{ post()!.commentsCount }})</h2>

        <div class="add-comment-form">
          <textarea 
            [(ngModel)]="newComment"
            placeholder="Escreva um coment치rio..."
            rows="3"
            class="comment-textarea"
            (keydown.control.enter)="onComment()"></textarea>
          <button 
            class="submit-comment-button" 
            (click)="onComment()"
            [disabled]="!newComment().trim()">
            Comentar
          </button>
        </div>

        <div class="comments-list">
          @if (post()!.comments.length === 0) {
            <div class="no-comments">
              <p>Nenhum coment치rio ainda. Seja o primeiro a comentar!</p>
            </div>
          } @else {
            @for (comment of post()!.comments; track comment.id) {
              <div class="comment-item">
                <div class="comment-header">
                  <div class="comment-author-info">
                    @if (comment.userPhotoUrl) {
                      <img [src]="comment.userPhotoUrl" [alt]="comment.userName || 'Usu치rio'" class="comment-avatar">
                    } @else {
                      <div class="comment-avatar-placeholder">
                        {{ (comment.userName || 'U').charAt(0).toUpperCase() }}
                      </div>
                    }
                    <div>
                      <h4 class="comment-author-name">{{ comment.userName || 'Usu치rio' }}</h4>
                      <span class="comment-time">{{ getTimeDiff(comment.dataComentario) }}</span>
                    </div>
                  </div>
                  
                  @if (canDeleteComment(comment)) {
                    <button class="delete-comment-button" (click)="onDeleteComment(comment.id)" title="Excluir coment치rio">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="3 6 5 6 21 6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                      </svg>
                    </button>
                  }
                </div>
                
                <p class="comment-content">{{ comment.conteudo }}</p>
              </div>
            }
          }
        </div>
      </div>
    </div>
  } @else {
    <div class="error-container">
      <p>Post n칚o encontrado</p>
    </div>
  }
</div>
