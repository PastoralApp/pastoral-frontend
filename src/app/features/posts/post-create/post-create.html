<div class="post-create">

  <div class="page-header mb-4">
    <div class="container">
      <div class="row align-items-center">
        <div class="col">
          <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-2">
              <li class="breadcrumb-item"><a routerLink="/posts" class="text-decoration-none">Posts</a></li>
              <li class="breadcrumb-item active">{{ isEditMode ? 'Editar' : 'Novo' }}</li>
            </ol>
          </nav>
          <h2 class="mb-0">
            <span class="material-icons align-middle me-2">{{ isEditMode ? 'edit' : 'post_add' }}</span>
            {{ isEditMode ? 'Editar Post' : 'Novo Post' }}
          </h2>
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-8">

        <div *ngIf="errorMessage" class="alert alert-danger d-flex align-items-center mb-4" role="alert">
          <span class="material-icons me-2">error</span>
          <div>{{ errorMessage }}</div>
        </div>

        <div class="card border-0 shadow-sm">
          <div class="card-body p-4">
            <form [formGroup]="postForm" (ngSubmit)="onSubmit()">

              <div class="mb-4">
                <label class="form-label fw-semibold">
                  <span class="material-icons align-middle me-1" style="font-size: 18px;">category</span>
                  Tipo do Post
                </label>
                <select class="form-select" formControlName="type">
                  <option *ngFor="let type of postTypeOptions" [value]="type.value">
                    {{ type.label }}
                  </option>
                </select>
              </div>

              <div class="mb-4">
                <label class="form-label fw-semibold">
                  <span class="material-icons align-middle me-1" style="font-size: 18px;">description</span>
                  Conteúdo
                </label>
                <textarea 
                  class="form-control" 
                  formControlName="content"
                  rows="10"
                  placeholder="Escreva o conteúdo do post..."
                  [class.is-invalid]="postForm.get('content')?.invalid && postForm.get('content')?.touched"></textarea>
                <div class="invalid-feedback" *ngIf="postForm.get('content')?.touched">
                  <span *ngIf="postForm.get('content')?.hasError('required')">Conteúdo é obrigatório</span>
                  <span *ngIf="postForm.get('content')?.hasError('minlength')">Mínimo de 10 caracteres</span>
                </div>
                <small class="text-muted">Mínimo de 10 caracteres</small>
              </div>

              <div class="mb-4">
                <label class="form-label fw-semibold">
                  <span class="material-icons align-middle me-1" style="font-size: 18px;">image</span>
                  URL da Imagem (opcional)
                </label>
                <input 
                  type="url" 
                  class="form-control" 
                  formControlName="imageUrl"
                  placeholder="https://exemplo.com/imagem.jpg">
                <small class="text-muted">Cole a URL de uma imagem externa</small>
              </div>

              <div *ngIf="postForm.get('imageUrl')?.value" class="mb-4">
                <label class="form-label fw-semibold">Preview</label>
                <div class="image-preview rounded overflow-hidden" style="max-height: 200px;">
                  <img [src]="postForm.get('imageUrl')?.value" 
                       class="img-fluid w-100" 
                       alt="Preview"
                       (error)="postForm.get('imageUrl')?.setValue(null)">
                </div>
              </div>

              <div class="d-flex justify-content-between align-items-center pt-3 border-top">
                <a routerLink="/posts" class="btn btn-outline-secondary">
                  <span class="material-icons align-middle me-1" style="font-size: 18px;">arrow_back</span>
                  Cancelar
                </a>
                <button type="submit" class="btn btn-success px-4" [disabled]="loading || postForm.invalid">
                  <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
                  <span *ngIf="!loading" class="material-icons align-middle me-1" style="font-size: 18px;">save</span>
                  {{ loading ? 'Salvando...' : (isEditMode ? 'Atualizar' : 'Publicar') }}
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
